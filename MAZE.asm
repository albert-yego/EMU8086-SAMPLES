ORG 100h    

.data
INIT DB 00000000b,00000000b,00000000b,00000000b,00000000b
     DB 01110111b,01000001b,01111001b,01111011b,01000001b
     DB 01011111b,01011111b,01010001b,01010101b,01000101b
     DB 01111101b,01000101b,01010001b,01010101b,01010101b
     DB 01100011b,01000001b,01011101b,01011101b,01011101b
     DB 01001001b,01000101b,01011101b,01100001b,01101111b
     DB 01000001b,01010101b,01010101b,01010101b,01111101b
     DB 00000000b,00000000b,00000000b,00000000b,00000000b

INPUT DB ? 
DOTPOS DB ?
INITPOS DW ?

.code
MOV AX, @data
MOV DS, AX
MOV ES, AX

DOT: 
LEA DX, INITPOS
MOV INITPOS[0],0
LEA DI, DOTPOS
MOV DX, 2000h 
MOV AL , 0001000b
MOV DOTPOS[0],AL 
MOV INIT[0],AL
OUT DX,AL 
JMP MAZE

MAZE:
MOV DX,2000h	
MOV BX, 0 

SECTION:
MOV SI, 0
MOV CX, 5
S:
MOV AL, INIT[BX][SI]
OUT DX, AL
INC SI
INC DX

CMP SI, 5
LOOPNE S

ADD BX, 5
CMP BX, 40
JL SECTION
JMP MOVEMENT

MOVEMENT:
LEA DI, INPUT
MOV AH, 00h
INT 16h
CMP AH, 48h 
JB MAZE
JE UP
CMP AH, 4Bh
JE LEFT
CMP AH, 4Dh
JE RIGHT
CMP AH, 50h
JA MAZE
JE DOWN

UP:
MOV AL, DOTPOS[0]
MOV DI, INITPOS[0]
TEST AL, 00000001b
JNZ MOVEMENT
SHR AL,1
TEST INIT[DI],AL
JNZ MOVEMENT
MOV DOTPOS[0],AL
ADD INIT[DI],AL
SHL AL,1
SUB INIT[DI],AL
MOV INITPOS,DI 
JMP NEW

LEFT:
MOV AL, DOTPOS[0]
MOV DI, INITPOS[0]
CMP DI, 0
JE MOVEMENT
TEST INIT[DI-1],AL
JNZ MOVEMENT
ADD INIT[DI-1], AL
SUB INIT[DI],AL
DEC DI
MOV DOTPOS[0],AL
MOV INITPOS[0],DI
JMP BACK

RIGHT:
MOV AL, DOTPOS[0]
MOV DI, INITPOS[0]
CMP DI, 39
JE MOVEMENT
TEST INIT[DI+1],AL
JNZ MOVEMENT
ADD INIT[DI+1], AL
SUB INIT[DI],AL
INC DI
MOV DOTPOS[0],AL
MOV INITPOS[0],DI
JMP NEW

DOWN: 
MOV AL, DOTPOS[0]
MOV DI, INITPOS[0]
TEST AL, 01000000b
JNZ MOVEMENT
SHL AL,1
TEST INIT[DI],AL
JNZ MOVEMENT
MOV DOTPOS[0],AL
ADD INIT[DI],AL
SHR AL,1
SUB INIT[DI],AL
MOV INITPOS,DI 
JMP NEW

NEW:
CMP DI,4
JBE SEC1
CALL LINE4
CMP DI,9
JBE SEC2 
CALL LINE9
CMP DI,14
JBE SEC3 
CALL LINE14
CMP DI,19
JBE SEC4
CALL LINE19
CMP DI,24
JBE SEC5
CALL LINE24
CMP DI,29
JBE SEC6
CALL LINE29
CMP DI,34
JBE SEC7
CALL LINE34
CMP DI,39
JBE SEC8
CALL LINE39
RET

BACK:
INC DI
CMP DI,5
JE LINE5 
CMP DI,10
JE LINE10
CMP DI,15
JE LINE15
CMP DI,20
JE LINE20
CMP DI,25
JE LINE25
CMP DI,30
JE LINE30
CMP DI,35
JE LINE35
DEC DI
JMP NEW

SEC1 PROC
MOV DX, 2000h
MOV SI,0
CALL SECTIONP
CMP DI,4
JBE MOVEMENT
CALL LINE5
RET
SEC1 ENDP
             
SEC2 PROC
MOV DX, 2005h
MOV SI,5
CALL SECTIONP
CMP DI,9
JBE MOVEMENT
RET
SEC2 ENDP

SEC3 PROC
MOV DX, 200Ah
MOV SI,10
CALL SECTIONP
CMP DI,14
JBE MOVEMENT
RET
SEC3 ENDP
     
SEC4 PROC
MOV DX, 200Fh
MOV SI,15
CALL SECTIONP
CMP DI,19
JBE MOVEMENT
RET
SEC4 ENDP
 
SEC5 PROC
MOV DX, 2014h
MOV SI,20
CALL SECTIONP
CMP DI,24
JBE MOVEMENT
RET
SEC5 ENDP

SEC6 PROC
MOV DX, 2019h
MOV SI,25
CALL SECTIONP
CMP DI,29
JBE MOVEMENT
RET
SEC6 ENDP
   
SEC7 PROC
MOV DX, 201Eh
MOV SI,30
CALL SECTIONP
CMP DI,34
JBE MOVEMENT
RET
SEC7 ENDP

SEC8 PROC
MOV DX, 2023h
MOV SI,35
CALL SECTIONP
CMP DI,39
JBE MOVEMENT
RET
SEC8 ENDP

SECTIONP PROC
MOV CX,5
SEP:
MOV AL, INIT[SI]
OUT DX,AL
INC SI
INC DX
LOOPNE SEP
RET
SECTIONP ENDP

LINE4 PROC
MOV DX, 2004h
MOV SI,4
CALL LINEP
CMP DI,4
JBE MOVEMENT
RET
LINE4 ENDP

LINE5 PROC
MOV DX, 2005h
MOV SI,5
CALL LINEP
DEC DI
JMP NEW
LINE5 ENDP

LINE9 PROC
MOV DX, 2009h
MOV SI,9
CALL LINEP
CMP DI,9
JBE MOVEMENT
RET
LINE9 ENDP

LINE10 PROC
MOV DX, 200Ah
MOV SI,10
CALL LINEP
DEC DI
JMP NEW
LINE10 ENDP

LINE14 PROC
MOV DX, 200Eh
MOV SI,14
CALL LINEP
CMP DI,14
JBE MOVEMENT
RET
LINE14 ENDP

LINE15 PROC
MOV DX, 200Fh
MOV SI,15
CALL LINEP
DEC DI
JMP NEW
LINE15 ENDP
    
LINE19 PROC
MOV DX, 2013h
MOV SI,19
CALL LINEP
CMP DI,19
JBE MOVEMENT
RET
LINE19 ENDP

LINE20 PROC
MOV DX, 2014h
MOV SI,20
CALL LINEP
DEC DI
JMP NEW
LINE20 ENDP

LINE24 PROC
MOV DX, 2018h
MOV SI,24
CALL LINEP
CMP DI,24
JBE MOVEMENT
RET
LINE24 ENDP

LINE25 PROC
MOV DX, 2019h
MOV SI,25
CALL LINEP
DEC DI
JMP NEW
LINE25 ENDP

LINE29 PROC
MOV DX, 201Dh
MOV CX,1
MOV SI,29
CALL LINEP
CMP DI,29
JBE MOVEMENT
RET
LINE29 ENDP

LINE30 PROC
MOV DX, 201Eh
MOV SI,30
CALL LINEP
DEC DI
JMP NEW
LINE30 ENDP

LINE34 PROC
MOV DX, 2022h
MOV SI,34
CALL LINEP
CMP DI,34
JBE MOVEMENT
RET
LINE34 ENDP

LINE35 PROC
MOV DX, 2023h
MOV SI,35
CALL LINEP
DEC DI
JMP NEW
LINE35 ENDP

LINE39 PROC
MOV DX, 2027h
MOV SI,39
CALL LINEP
CMP DI,39
JBE MOVEMENT
RET
LINE39 ENDP

LINEP PROC
MOV CX, 1
MOV AL, INIT[SI]
OUT DX,AL
RET
LINEP ENDP